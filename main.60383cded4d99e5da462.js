(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},t={link:"https://mesto.nomoreparties.co/v1/apf-cohort-202/",headers:{authorization:"3c2c77db-a562-41f1-b315-53392c0c264a","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",(function(t){return c(t,e)})),e.addEventListener("mousedown",(function(t){return u(t,e)}))}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",(function(t){return c(t,e)})),e.removeEventListener("mousedown",(function(t){return u(t,e)}))}var c=function(e,t){"Escape"===e.key&&o(t)},u=function(e,t){e.target===e.currentTarget&&o(t)};function a(e,c){var u=e.name,a=e.link,s=e.likes,l=e._id,d=e.owner,p=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),f=document.querySelector(".popup_type_delete-card"),_=f.querySelector(".popup__button"),v=p.querySelector(".card__title"),m=p.querySelector(".card__image"),y=p.querySelector(".card__like-button"),h=p.querySelector(".card__likes-count"),S=p.querySelector(".card__delete-button");return v.textContent=u,m.src=a,m.alt=u,i(y,h,s,c),y.addEventListener("click",(function(){var e;(y.classList.contains("card__like-button_is-active")?(e=l,fetch("".concat(t.link,"cards/").concat(e,"/likes"),{method:"DELETE",headers:t.headers}).then(n)):function(e){return fetch("".concat(t.link,"cards/").concat(e,"/likes"),{method:"PUT",headers:t.headers}).then(n)}(l)).then((function(e){i(y,h,e.likes,c)})).catch((function(e){return console.error("Ошибка при изменении лайка:",e)}))})),d._id!==c?S.remove():S.addEventListener("click",(function(){r(f),_.addEventListener("click",(function(e){e.preventDefault();var r,c=_.textContent;_.textContent="Удаление...",(r=l,fetch("".concat(t.link,"cards/").concat(r),{method:"DELETE",headers:t.headers}).then(n)).then((function(){S.closest(".card").remove(),o(f)})).catch((function(e){return console.error("Ошибка при удалении карточки:",e)})).finally((function(){_.textContent=c}))}),{once:!0})})),m.addEventListener("click",(function(){var e=document.querySelector(".popup__image"),t=document.querySelector(".popup__caption");e.src=a,e.alt=u,t.textContent=u,r(document.querySelector(".popup_type_image"))})),p}function i(e,t,n,r){t.textContent=n.length>0?n.length:"",n.some((function(e){return e._id===r}))?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active")}var s,l=function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);d(n,r),n.forEach((function(o){o.addEventListener("input",(function(){(function(t,n){n.validity.valid?function(t,n){var r=t.querySelector("#input-".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""}(t,n):function(t,n,r){var o=t.querySelector("#input-".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.textContent=r,o.classList.add(e.errorClass)}(t,n,n.validationMessage)})(t,o),d(n,r)}))}))},d=function(t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(e.inactiveButtonClass),n.setAttribute("disabled",!0))},p=document.querySelector(".places__list"),f=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_avatar"),m=document.querySelectorAll(".popup"),y=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__avatar-edit"),q=document.querySelectorAll(".popup__close"),k=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),E=f.querySelector(".popup__form"),L=E.querySelector(".popup__input_type_name"),x=E.querySelector(".popup__input_type_description"),g=_.querySelector(".popup__form"),A=_.querySelector(".popup__input_type_card-name"),w=_.querySelector(".popup__input_type_url"),T=v.querySelector(".popup__form"),D=v.querySelector(".popup__input_type_url");m.forEach((function(e){e.classList.add("popup_is-animated")})),function(e){e.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup");t&&o(t)}))}))}(q),y.addEventListener("click",(function(){L.value=k.textContent,x.value=b.textContent,r(f)})),E.addEventListener("submit",(function(e){e.preventDefault();var r=L.value,c=x.value,u=e.target.querySelector("button");u.textContent="Сохранение...",function(e){var r=e.username,o=e.description;return fetch("".concat(t.link,"users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:o})}).then(n)}({username:r,description:c}).then((function(e){var t=e.name,n=e.about;k.textContent=t,b.textContent=n,o(f)})).catch((function(e){return console.error("Ошибка обновления профиля:",e)})).finally((function(){u.textContent="Сохранить"}))})),h.addEventListener("click",(function(){r(_)})),g.addEventListener("submit",(function(e){e.preventDefault();var r=A.value,c=w.value,u=e.target.querySelector("button");u.textContent="Сохранение...",function(e){var r=e.name,o=e.link;return fetch("".concat(t.link,"cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:o})}).then(n)}({name:r,link:c}).then((function(e){var t=a(e,s);p.prepend(t),o(_),g.reset()})).catch((function(e){return console.error("Ошибка добавления карточки:",e)})).finally((function(){u.textContent="Сохранить"}))})),S.addEventListener("click",(function(){r(v)})),T.addEventListener("submit",(function(e){e.preventDefault();var r=D.value,c=e.target.querySelector("button");c.textContent="Сохранение...",function(e){var r=e.avatar;return fetch("".concat(t.link,"users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:r})}).then(n)}({avatar:r}).then((function(e){var t=e.avatar;C.src=t,o(v),T.reset()})).catch((function(e){return console.error("Ошибка изменения аватара:",e)})).finally((function(){c.textContent="Сохранить"}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){l(e)}))}(e),fetch("".concat(t.link,"users/me"),{headers:t.headers}).then(n).then((function(e){var t=e.name,n=e.about,r=e.avatar,o=e._id;k.textContent=t,b.textContent=n,C.src=r,s=o})).catch((function(e){return console.error("Ошибка загрузки данных пользователя:",e)})),fetch("".concat(t.link,"cards"),{headers:t.headers}).then(n).then((function(e){e.forEach((function(e){var t;(t=e.link,new Promise((function(e,n){var r=new Image;r.onload=function(){return e(!0)},r.onerror=function(){return n(!1)},r.src=t}))).then((function(){var t=a(e,s);p.append(t)})).catch((function(){console.log('Фото для карточки "'.concat(e.name,'" не загрузилось. Карточка пропущена.'))}))}))})).catch((function(e){return console.error("Ошибка загрузки карточек:",e)}))})();